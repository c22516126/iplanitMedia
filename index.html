<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>iPlanit</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div class="container-fluid">
        <!-- Top Navigation -->
        <div class="top-nav">
            <img src="images\pfp.png" alt="Profile Picture" class="profile-pic">
            <div class="nav-buttons">
                <button class="nav-button messages-button">Messages</button>
                <button class="nav-button media-button">Media</button>
                <button class="nav-button calendar-button">Calendar</button>
                <button class="side-button plan-button">Plan</button>
                <button class="side-button goals-button">Goals</button>
                <button class="side-button notes-button">Notes</button>
            </div>
            
            <div class="media-box">
                <img src="images\uploadimg.png" alt="Upload Icon" class="upload-icon">
                <a href="#galleryModal" class="media-button-gray" data-bs-toggle="modal">Select Photo</a>
                <button class="media-button-gray" onclick="window.location.href='camera.html'">Take Photo</button>
            </div>

            <div class="recent-uploads">
                <h6>Recent Uploads</h6>
                <div class="uploaded-images" id="uploadedImagesContainer">
                    <!-- Uploaded images will be dynamically added here -->
                </div>
            </div>
        </div>

        <!-- Image Selection Modal -->
        <div class="modal fade" id="galleryModal" tabindex="-1">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Choose a Photo</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <div class="gallery">
                            <img src="images\images (1).jpg" class="gallery-img" data-image-src="images\images (1).jpg">
                            <img src="images\images (2).jpg" class="gallery-img" data-image-src="images\images (2).jpg">
                            <img src="images\images.jpg" class="gallery-img" data-image-src="images\images.jpg">
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Confirmation Modal -->
        <div class="modal fade" id="confirmUploadModal" tabindex="-1">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Confirm Upload</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <img id="confirmImage" src="" style="max-width: 100%; margin-bottom: 15px;">
                        <div class="d-grid gap-2">
                            <button id="uploadConfirmBtn" class="btn btn-primary">Upload</button>
                            <button id="cancelUploadBtn" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Footer -->
        <div class="footer">
            <img src="images\iplanitlogo.png" alt="Iplanit logo">
            <img src="images\sjoglogo.png" alt="St John of God Logo">
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Gallery image selection
            const galleryImages = document.querySelectorAll('.gallery-img');
            const confirmImage = document.getElementById('confirmImage');
            const confirmUploadModal = new bootstrap.Modal(document.getElementById('confirmUploadModal'));
            const uploadConfirmBtn = document.getElementById('uploadConfirmBtn');

            galleryImages.forEach(img => {
                img.addEventListener('click', () => {
                    const imageSrc = img.getAttribute('data-image-src');
                    confirmImage.src = imageSrc;
                    confirmUploadModal.show();
                });
            });

            uploadConfirmBtn.addEventListener('click', () => {
                // Store the selected image source in local storage
                localStorage.setItem('selectedImageSrc', confirmImage.src);
                
                // Navigate to upload page
                window.location.href = 'upload.html';
            });

            // Check for uploaded images in local storage
            const uploadedImagesContainer = document.getElementById('uploadedImagesContainer');
            let uploadedImages = JSON.parse(localStorage.getItem('uploadedImages') || '[]');
    
            // Function to render uploaded images with delete buttons
            function renderUploadedImages() {
                // Clear existing content
                uploadedImagesContainer.innerHTML = '';
    
                // Render images with delete buttons
                uploadedImages.forEach((imageSrc, index) => {
                    // Create a container for each image
                    const imageWrapper = document.createElement('div');
                    imageWrapper.classList.add('uploaded-image-wrapper');
    
                    // Create image element
                    const imgElement = document.createElement('img');
                    imgElement.src = imageSrc;
                    imgElement.classList.add('uploaded-img');
    
                    // Create delete button
                    const deleteBtn = document.createElement('button');
                    deleteBtn.innerHTML = '&times;'; // "Ã—" symbol
                    deleteBtn.classList.add('delete-upload-btn');
                    deleteBtn.addEventListener('click', () => {
                        // Remove the image from the array
                        uploadedImages.splice(index, 1);
                        
                        // Update local storage
                        localStorage.setItem('uploadedImages', JSON.stringify(uploadedImages));
                        
                        // Re-render images
                        renderUploadedImages();
                    });
    
                    // Append image and delete button to wrapper
                    imageWrapper.appendChild(imgElement);
                    imageWrapper.appendChild(deleteBtn);
    
                    // Add to container
                    uploadedImagesContainer.appendChild(imageWrapper);
                });
            }
    
            // Function to add a new uploaded image
            function addUploadedImage(imageSrc) {
                // Prevent duplicate uploads
                if (!uploadedImages.includes(imageSrc)) {
                    uploadedImages.push(imageSrc);
                    localStorage.setItem('uploadedImages', JSON.stringify(uploadedImages));
                    renderUploadedImages();
                }
            }
    
            // Initial render of uploaded images
            renderUploadedImages();
    
            // Check if there's a newly uploaded image
            const newUploadedImage = localStorage.getItem('selectedImageSrc');
            if (newUploadedImage) {
                addUploadedImage(newUploadedImage);
                // Clear the selected image src
                localStorage.removeItem('selectedImageSrc');
            }
        });
    </script>
</body>
</html>